  <!--{include control/admin/tpl/admin_header}-->
<div class="page_title">
    <h1>{$_lang['union_api_config_manage']}</h1>
    <div class="tool">
			 <a href="index.php?do=keke&view=account&op=apply" class="here">{$_lang['union_api_apply']}</a>
       		 <a href="index.php?do=keke&view=account&op=config">{$_lang['union_api_config']}</a>
    </div>
</div>
<div class="box post">
    <div class="tabcon">
        <div class="title">
            <h2>{$_lang['union_API_apply']}</h2>
        </div>
        <div class="detail">
           <div class="t_c"><h2 class="hidden" id="tips" style="color:red"></h2></div>
		   <table width="100%" border="0" cellspacing="0" cellpadding="0">
            <form name="frm_apply_kekeapi" id="frm_apply_kekeapi" action="{$url}" method="post" accept-charset="{$_K['charset']}">
           		<input type="hidden" name="formhash" id="formhash" value="{FORMHASH}" />
				<input type="hidden" name="reg_ip" value="{$reg_ip}"/>
                    <tbody>
                        <tr>
                            <th scope="row" width="130">用户名</th>
                            <td>
                                <input type="text" class="txt" autocomplete="off" name="username" id="txt_username" limit="required:true;len:2-20;type:string;general:true" msg="{$_lang['input_account_error']}"  title="{$_lang['please_input_register_account']}"  msgArea="login_account_msg"/><font color="red">*</font><span class="login_msg" id="login_account_msg">{$_lang['please_input_register_account']}</span>
                            </td>
                        </tr>
                        
                        <tr>
                        	<th scope="row" width="130">{$_lang['password']}</th>
                        	<td>
                        		<input type="password" class="txt" name="password" id="pwd_password" limit="required:true;len:6-20"
								 msg="{$_lang['password_input_error']}" title="{$_lang['password_input_limit']}" msgArea="password_msg"/>
							<font color="red">*</font><span class="login_msg" id="password_msg">{$_lang['please_input_password']}</span>
                        	</td>
                        </tr>
                        <tr>
                        	<th scope="row" width="130">{$_lang['confirm_password']}</th>
                        	<td>
                        		<input type="password" class="txt" name="pwd_password2" id="pwd_password2" limit="required:true;equals:pwd_password"
								 	msg="{$_lang['repeat_password_error']}" title="{$_lang['please_input_repeat_password']}" msgArea="password2_msg"/>
							 	<span class="login_msg" id="password2_msg">{$_lang['please_input_password_again']}</span>
                        	</td>
                        </tr>
						<tr>
                            <th scope="row" width="130">联系人</th>
                            <td>
                                <input type="text" class="txt" autocomplete="off" name="realname" id="txt_realname" limit="required:true;len:2-20" msg="{$_lang['input_real_name_error']}" title="{$_lang['real_name_not_null']}" msgArea="login_realname_msg"/><font color="red">*</font><span class="login_msg" id="login_realname_msg">{$_lang['input_real_name']}</span>
                            </td>
                        </tr>
                        <tr>
                        	<th scope="row" width="130">联系电话：</th>
                        	<td>
                        		<input autocomplete="off" class="txt" type="text" type="text" name="phone" 
								value="{$admin_info['mobile']}"
								id="txt_phone" limit="type:mobileCn;required:true"
								 msg="{$_lang['telephone_error']}" title="请输入手机号" msgArea="phone_msg"/>
								<font color="red">*</font> <span class="login_msg" id="phone_msg">请输入手机号</span>
								 <input type="button" id="get_code"  value="获取验证码" >
								 <input type="hidden" value="0" name="mo_p" id="mo_p">
								 <div id="div_mobile" style="display:none;">
								    <input type="text" class="txt" size="5" name="mobile_code" id="mobile_code">
									<input type="button" id="sub_code"  value="提交">
									<span id="mobile_msg">请输入验证码</span>	
								 </div>
							
							<script type="text/javascript">
								var k = 60;
								$(function(){
								$("#get_code").click(function(){
										var url = "{$url}?do=get_code&phone="+$('#txt_phone').val()+'&ip={$reg_ip}&call=?';
										$.getJSON(url,function(json){
											if(json.status==1){
											  $("#get_code").attr('disabled','true');
											  $('#div_mobile').show();
												var ds = setInterval(function(){
													k--;
													$("#get_code").val(k+'秒再次获取');
											   	 	if(k==0){
														$("#get_code").val('获取验证码').attr("disabled","");
														k = 60;
														clearInterval(ds);
													}	
													},1000);
											}else if(json.status==2){
												art.dialog.alert('该手机号码已被认证');
											}else{
												art.dialog.alert('验证码发送失败');
											}
										});
									})
									$("#sub_code").click(function(){
										var url = "{$url}?do=valid_code&phone="+$('#txt_phone').val()+"&mobile_code="+$("#mobile_code").val()+"&call=?";
										$.getJSON(url,function(json){
											if(json.status==1){
												$("#mobile_msg").html('<font color="green">手机验证成功</font>');
												$('#mo_p').val(1);
											}else{
												$("#mobile_msg").html('<font color="red">验证码错误</font>');
											}
										},'json')
									})
								})
							
							</script>
                        	</td>
                        </tr>
                        <tr>
                        	<th scope="row" width="130">QQ：</th>
                        	<td>
                        		<input  autocomplete="off" class="txt" type="text"  name="qq" id="txt_qq" limit="required:true;type:digit;len:5-20"
								 msg="{$_lang['qq_error']}" title="{$_lang['input_qqnum']}" msgArea="qq_msg"/>
								<font color="red">*</font><span class="login_msg" id="qq_msg">{$_lang['input_qq']}</span>
                        	</td>
                        </tr>
                        <tr>
                        	<th scope="row" width="130">联系邮箱：</th>
                        	<td>
                        		<input autocomplete="off" class="txt" type="text" name="email" id="txt_email" limit="type:email;required:true;len:6-50"
								msg="{$_lang['email_format_error']}" title="{$_lang['email_format']}user@qq.com"  msgArea="email_msg"/>
								<font color="red">*</font><span class="login_msg" id="email_msg">{$_lang['please_input_eamil']}，{$_lang['input_email_send_info']}</span>
                        	</td>
                        </tr>
                        <tr>
                        	<th scope="row" width="130">支付宝账号：</th>
                        	<td>
                        		<input autocomplete="off" class="txt" type="text" name="alipay_acc" id="alipay_acc" limit="required:true"
								msg="请填写您的支付宝账号"  msgArea="alipay_acc_msg"/>
								<font color="red">*</font><span class="login_msg" id="alipay_acc_msg">（联盟目前仅支持支付宝账号绑定）</span>
                        	</td>
                        </tr>
                        <tr>
                        	<th scope="row" width="130">{$_lang['sitename']}</th>
                        	<td>
                        		<input autocomplete="off" class="txt" type="text" name="sitename" id="txt_sitename" limit="required:true;len:2-50" msg="{$_lang['website_name_error']}" title="{$_lang['input_website_name']}"  msgArea="sitrname_msg"/>
							<font color="red">*</font><span class="login_msg" id="sitrname_msg">{$_lang['input_site_name']}</span>
                        	</td>
                        </tr>
                        <tr>
                        	<th scope="row" width="130">{$_lang['website_desc']}</th>
                        	<td>
                        		<textarea id="site_desc" name="site_desc"></textarea>
							<span id="site_desc_msg"></span>
                        	</td>
                        </tr>
                        <tr>
                        	<th scope="row" width="130">ICP备案</th>
                        	<td>
                        		<input type="text"  class="txt" name="icp" id="txt_icp" limit="required:true" msg="{$_lang['record_info_not_null']}" title="{$_lang['input_record_info']}"  msgArea="icp_msg"/>
							<font color="red">*</font><span id="icp_msg">{$_lang['input_record_info']}</span>
                        	</td>
                        </tr>
                        <tr>
                        	<th scope="row" width="130">{$_lang['siteurl']}</th>
                        	<td>
                        		<input autocomplete="off" class="txt" type="text" size="100"  name="siteurl" id="siteurl" value="{$_K['siteurl']}" id="txt_siteurl"limit="required:true"
								 msg="{$_lang['website_links_error']}" title="{$_lang['input_website_name_like']}" msgArea="siteurl_msg"/>
							<font color="red">*</font><span class="login_msg" id="siteurl_msg">{$_lang['input_website_name_like']}</span>
                        	</td>
                        </tr>
                        <tr>
                        	<th scope="row" width="130">{$_lang['syn_notify_address']}</th>
                        	<td>
                        		<input type="text" id="return_url" class="txt" size="100" name="return_url" value="{$_K['siteurl']}/keke_client/keke/return.php" limit="required:true"
								 msg="{$_lang['sys_notify_address_error']}" title="{$_lang['input_union_sys_syn_notify_address']}" msgArea="return_url_msg"/>
							<font color="red">*</font><span class="login_msg" id="return_url_msg">{$_lang['union_sys_syn_notify_address']}</br>{$_lang['like_return']}</span>
                        	</td>
                        </tr>
                        <tr>
                        	<th scope="row" width="130">{$_lang['asy_notify_address']}</th>
                        	<td>
                        		<input type="text" id="notify_url" class="txt" size="100"  name="notify_url" value="{$_K['siteurl']}/keke_client/keke/notify.php" limit="required:true"
								 msg="{$_lang['sys_notify_address_error']}" title="{$_lang['input_union_sys_asy_notify_address']}" msgArea="notify_url_msg"/>
								<font color="red">*</font><span class="login_msg" id="notify_url_msg">{$_lang['union_sys_asy_notify_address']}</br>{$_lang['like_notify']}</span>
                        	</td>
                        </tr>
					
                    </tbody>
            </form>
                    <th scope="row">
                        &nbsp;
                    </th>
                    <td>
                        <div class="clearfix padt10">
                            <button class="positive pill primary button" type="submit" name='submit' value="{$_lang['submit']}" onclick="frm_submit();" >
                                <span class="check icon"></span>{$_lang['submit']}
                            </button>
                            <button class="pill button" type="button" onclick="history.go(-1);" value="{$_lang['return']}">
                                <span class="leftarrow icon"></span>{$_lang['return']}
                            </button>
                        </div>
                    </td>
                </table>
        </div>
    </div>
</div>
<script type="text/javascript" src="../../resource/js/system/form_and_validation.js"></script>
<script type="text/javascript">
	$("#site_desc").focus(function(){
		$("site_desc_msg").html(' ');
	})
	function frm_submit(){
		var i = checkForm(document.getElementById('frm_apply_kekeapi'));		
		if(!i){
			return false;
		}
		if($("#site_desc").val().length==0){
			$("#site_desc_msg").html(L.website_desc_not_null);
			return false;
		}
		var siteurl = $("#siteurl").val();		
		if(siteurl=='http://'){			
			$("#siteurl_msg").html($("#siteurl").attr("msg"));
			$("#siteurl").focus();
			return false;
		}
		var notify_url = $("#notify_url").val();		
		if(notify_url=='http://'){
			$("#notify_url_msg").html($("#notify_url").attr("msg"));
			$("#notify_url").focus();
			return false;
		}
		if($('#mo_p').val()==0){
			$('#txt_phone').focus();
			$("#phone_msg").html('请先验证手机号码');
			return false;
		}
		$("#frm_apply_kekeapi").submit();		
			
	}
	$.get('{$gate}/remote.php?do=appcheck&call=?',function(json){
		if(json.status>-1){
			var t = json.status;
			var s = '您的应用申请';
				if(t==0){
					s += '正在审核中...';
				}else if(t==1){
					s += '已通过审核,请尽快配置(您可以在您的邮箱中获取到应用编号及密钥)';
				}else{
					s += '未通过审核,您可以再次申请或联系联盟客服';
				}
			$('#tips').removeClass('hidden').html(s);
		}
	},'json');
</script>
<!--{include control/admin/tpl/admin_footer}-->